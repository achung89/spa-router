<script src='helper-functions.js' type='text/javascript'></script>
<script>
let handleStateChange = function(event) {
          //event.preventDefault();
          if( !event.state ) {
          } else if ( event.state._spa_PATH ) {

            let pathname = event.state._spa_PATH;
            var routeComponents = this._routeComponents;
            for ( var i = 0; i < routeComponents.length; i++ ) {

              routeComponent = routeComponents[i];
              if ( routeComponent.path === pathname ) {
                routeComponent.render.call(routeComponent);
              } else {
                if ( routeComponent.innerHTML ) {
                  //implementation subject to change
                  routeComponent.innerHTML = '';
                }
              }
            }
          }
        }

let routeBehaviors = {
    ready: function() {
        this._routeComponents.push(this);
        //console.log(this._routeComponents);
      },

      render: function() {
        //console.log(this.path);
        context = this;
        fetch('/'+this.path+'.html')
          .then(function(data) {
            //console.log(data);
            return data.text();
          })
          .then(function(data) {
            
            var parsedNodes = parseXML ( data );
            //console.log(parsedNodes);
            var nodes = Array.from ( parsedNodes );
            //console.log(nodes);
            Polymer.dom(context.root).innerHTML = '';
            nodes.forEach ( function ( node ) {
              //console.log(node);
              Polymer.dom ( context.root ).appendChild ( node );
            })
            context.distributeContent(true);
            executeEmbeddedJavascript(getScriptsContentInDoc());
          })
          .catch(function errored(err){
            console.log(err);
          })
      },
      
      // Will implement with data-binding functionality
      // injectBoundHTML: function injectBoundHTML(html, element) {
      //   var template = document.createElement('template', 'dom-bind');
      //   var doc = template.content.ownerDocument;
      //   var div = doc.createElement('div');
      //   div.innerHTML = html;
      //   template.content.appendChild(div);
      //   while (element.firstChild) {
      //       element.removeChild(element.firstChild);
      //   }
      //   element.appendChild(Polymer.Base.instanceTemplate(template));
      // },
      // isLoaded: function() {
      //   return 
      // },
      registered: function() {
        //console.log('hi',this);
        this._routeComponents = [];
        window.addEventListener('popstate',handleStateChange.bind(this));
        
      },
}
</script>