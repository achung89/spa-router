<link rel="import" href="../polymer/polymer.html">
<!--
`spa-route`
Simple single page router component

@demo demo/index.html 
-->

<dom-module id="spa-route">

  <template>
  </template>

  <script>
    Polymer({
      is: 'spa-route',

      properties: {
        path: {
          type: String,
        },
        fileName: {
          type: String,
        },
       
      },

      ready: function() {
        this._routeComponents.push(this)
        console.log(this._routeComponents);
        // window.history.pushState({_spa_PATH: this.path},'',this.path);
      },

      render: function() {
        console.log(this.path);
        context = this;
        fetch('/'+this.path+'.html')
          .then(function(data) {
            return data.text();
          })
          .then(function(data){
            console.log(data);
            context.innerHTML = data;
          })
          .catch(function errored(err){
            console.log(err);
          })
      },

      registered: function() {
        console.log('hi',this);
        var context=this;
        this._routeComponents = [];

        window.addEventListener('popstate', function(event) {
          var pathname = event.state._spa_PATH
          if ( pathname ) {
            var render = function() {};
            var routeComponents = context._routeComponents;
            for ( var i = 0; i < routeComponents.length; i++ ) {

              routeComponent = routeComponents[i];

              if ( routeComponent.path === pathname ) {
                routeComponent.render.call(routeComponent);

              } else {

                if ( routeComponent.innerHTML ) {
                  //implementation may vary
                  routeComponent.innerHTML = '';
                }
              }
            }
            render();
          }
        });
      }
    });
  </script>
</dom-module>
